<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
    rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>



  <style>
    .number-count {
    font-size: 36px;
    font-weight: bold;
    text-align: center;
    margin-top: 20px;
    color:#474242;
    margin-bottom:15px;
  }
    body {
      background-color: #c3ced79d;
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      padding: 0px;
      color: #474242;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    }

    h1 {
      font-size: 40px;
      font-weight: bold;
      margin-top: 20px;
      color: #474242;
      opacity: 1;
      text-align:center;
      justify-content:center;
      align-items:center;

    }

    h2 {
      font-size: 30px;
      font-weight: bold;
      margin-top: 20px;
      color: #474242;
      opacity: 1;
      text-align: center;
      justify-content: center;
      align-items: center;
    }

    .navbar {
      background-color: #fff;
      margin-top: 0;
      width: 100%;
    }

    .navbar-brand img {
      height: 50px;
      margin-right: 15px;
    }

    .side-navbar {
      height: 100%;
      width: 250px;
      position: fixed;
      z-index: 1;
      top: 0;
      left: -250px;
      background-color: #fff;
      padding-top: 20px;
      transition: 0.5s;
    }

    .side-navbar a {
      padding: 16px;
      text-decoration: none;
      font-size: 18px;
      color: #474242;
      display: block;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    }

    .side-navbar a:hover {
      color: #474242;
    }

    .toggle-area {
      position: fixed;
      top: 0;
      left: 0;
      height: 100%;
      width: 20px;
      background-color: transparent;
      z-index: 2;
      transition: 0.5s;
    }

    .toggle-area:hover+.side-navbar,
    .side-navbar:hover,
    .toggle-area.active+.side-navbar {
      left: 0;
    }

    .toggle-area:hover,
    .side-navbar:hover,
    .toggle-area.active {
      cursor: pointer;
    }


    h3 {
      font-size: 30px;
      margin-top: 5px;
      color: #474242;
      opacity: 1;
      margin-left:25px;
    }

 

    table {
      border-collapse: collapse;
      width: 90%;
      justify-content: center;
      align-items:center;
      border-radius:8px;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 4px;
      text-align: left;
      color:#000
    }

    th {
      background-color: #f2f2f2;
      color:#000
      
    }

    tr:nth-child(even) {
      background-color: #f2f2f2;
    }

    button {
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .container {
      background-color: #f1f1f1;
      color: #474242;
      font-size: 18px;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }


    h4{
        font-size: 20px;
      font-weight: bold;
      margin-top: 20px;
      color: #474242;
      opacity: 1;
      margin-left:25px;
      
    }

    input{
        font-size:15px;
        margin-left:5px;
        padding:10px;
        margin-bottom:10px;
        display:flex;

    }

.card-container {
  display: flex;
  justify-content: space-between; /* Adjust as needed */
}

.card {
  flex: 0 0 calc(33.33% - 20px); /* Adjust card width as needed */
  margin-bottom: 20px;
  background-color: #f1f1f1;
  color:#fff;
  padding:10px;
  margin-right:25px;

}


h5{
  color:#474242;
  text-align:center;
  justify-content:center;
  align-items: center;
  font-size:25px;
  font-style: bold;
  padding:20px;

}

.course-profile-container {
    background-color: #f1f1f1;
    border-radius: 8px;
    padding: 10px;
    margin-top: 20px;
    width: 96.2%;
    margin-left: auto;
    margin-right: auto;
}


select{
margin-top:8px;
    padding:20px;
    width:80%;
    align-items:center;
    justify-content: center;
}
p{
    color:#474242;
    margin-left:15px;
}
  </style>
</head>
<body>
  <div class="toggle-area" onclick="toggleSidebar()"></div>

  <div class="side-navbar">
    <a href="{{ url_for('registration') }}"><i class="fas fa-clipboard-list"></i> Registration Page</a>
    <a href="{{url_for('results')}}"><i class="fas fa-upload"></i> Results Upload</a>
    <a href="{{url_for('statistics')}}"><i class="fas fa-history"></i> Course Statistics</a>
  </div>

  <div class="content">
    <nav class="navbar navbar-expand-lg navbar-light">
      <button class="navbar-toggler" type="button" data-toggle="offcanvas">
        <span class="navbar-toggler-icon"></span>
      </button>
      <a class="navbar-brand" href="#">
        <img src="{{ url_for('static', filename='logo.png') }}">
      </a>
    </nav>
    <h1>Welcome to SSN NPTEL Examinations Management System</h1>
    <h2>Course Statistics</h2>
    <div class="container">
      <select id="courseSelector" class="form-control mb-3" style="width: 60%;margin:auto;height:50px;padding:10px;">
        <option value="None">Select the course to view the course statistics.</option>
        {% for course in courses %}
        <option value="{{ course.name }}">{{ course.name }}</option>
        {% endfor %}
      </select>
      <h3>Course Profile</h3>
      <div class="course-profile-container">
        <h4>Course Name: <span id="courseName"></span></h4>
        <h4>Course Code: <span id="courseCode"></span></h4>
        <h4>Duration of the Course: <span id="courseDuration"></span></h4>
        <h4>Course Link: <span id="courseLink"></span></h4>
      </div>
      <div class="container">
        <div class="card-container">
          <div class="card">
            <h5 class='card-title'>Course Statistics</h5>
            <p>Number of students enrolled: <span id="enrolledCount">100</span></p>
            <p>Average score:<span id='averageScore'></span></p>
            <p>Highest Mark:<span id='highestMark'></span></p>
            <p>View Toppers for the Course</p>
            <table id="toppersTable" class="table" style="width: 100%;align-items: center;justify-content: center;">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Marks</th>
                  <th>Year</th>
                </tr>
              </thead>
              <tbody id="toppersBody">
                {% for topper in toppers %}
                <tr>
                  <td>{{ topper.name }}</td>
                  <td>{{ topper.marks }}</td>
                  <td>{{ topper.year }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          <div class="card">
            <h5 class="card-title">Student Enrollment Count</h5>
            <canvas id="enrollmentChart" width="200" height="200"></canvas>
          </div>
          <div class="card">
            <h5 class="card-title">Scores Trend over the years </h5>
            <canvas id="marksDistributionChart" width="200" height="200"></canvas>
          </div>
        </div>
      </div>
    </div>
    <script>
      // Fetch course details from Flask and update HTML elements
      $(document).ready(function () {
        $('#courseSelector').change(function () {
          var selectedCourse = $(this).val();
          $.ajax({
            url: '/get_course_details', 
            method: 'GET',
            data: { 'course': selectedCourse },
            success: function (response) {
              // Update HTML elements with course details
              $('#courseName').text(response.courseName);
              $('#courseCode').text(response.courseCode);
              $('#courseDuration').text(response.courseDuration);
              $('#courseLink').text(response.courseLink);
              $('#enrolledCount').text(response.enrolledCount);
              $('#averageScore').text(response.averageScore);
              $('#highestMark').text(response.highestMark);

              // Update toppers table
              var toppersTable = $('#toppersBody');
              toppersTable.empty();
              response.toppers.forEach(function (topper) {
                toppersTable.append(`<tr><td>${topper.name}</td><td>${topper.marks}</td><td>${topper.year}</td></tr>`);
              });

              // Update enrollment chart
              var enrollmentData = {
                labels: response.enrollmentLabels,
                datasets: [{
                  label: 'Student Enrollment Count',
                  backgroundColor: '#000',
                  borderColor: 'rgba(54, 162, 235, 1)',
                  borderWidth: 1,
                  data: response.enrollmentData
                }]
              };
              var enrollmentChart = new Chart($('#enrollmentChart'), {
                type: 'bar',
                data: enrollmentData,
                options: {
                  responsive: true,
                  maintainAspectRatio: true,
                  scales: {
                    yAxes: [{
                      ticks: {
                        beginAtZero: true,
                        stepSize: 25,
                        max: 400
                      }
                    }]
                  }
                }
              });

              // Update marks distribution chart
              var marksDistributionData = {
                labels: response.marksLabels,
                datasets: response.marksDatasets
              };
              var marksDistributionChart = new Chart($('#marksDistributionChart'), {
                type: 'line',
                data: marksDistributionData,
                options: {
                  responsive: true,
                  maintainAspectRatio: true,
                  scales: {
                    yAxes: [{
                      ticks: {
                        beginAtZero: true,
                        stepSize: 5,
                        max: 40
                      }
                    }]
                  },
                  maxWidth: 500,
                  maxHeight: 500
                }
              });
            },
            error: function (xhr, status, error) {
              console.error(error);
            }
          });
        });
      });
    </script>
</body>
</html>